import{d as fe,L as A,r,c as I,b as s,e as t,f as l,h as i,M as _e,i as b,m as u,t as k,F as Y,j as E,N as ge,k as O,v as be,D as Ce,_ as ye}from"./index-97e706ba.js";const we={class:"check-task"},Ve={class:"page-header"},Te={class:"statistics-value"},Ne={class:"number"},xe={class:"sub-info"},Ie={class:"completed"},Re={class:"pending"},Pe={class:"statistics-value"},je={class:"number"},Le={class:"statistics-value"},Me={class:"number"},Se={class:"sub-info"},Ue={class:"danger"},De={class:"warning"},Ye={class:"statistics-value"},Ee={class:"number"},ze={class:"search-wrapper"},$e={class:"card-header"},qe={class:"header-operations"},Be={class:"pagination-container"},Fe={class:"check-items-wrapper"},He={class:"selected-items"},We={class:"items-header"},Ae={class:"item-selector"},Oe={class:"selector-header"},Xe={class:"selector-body"},Ke=fe({__name:"index",setup(Ge){const p=A({totalCount:12,completedCount:8,pendingCount:4,completionRate:85,issueCount:15,highRiskCount:3,mediumRiskCount:7,rectificationRate:90}),v=r({taskNo:"",department:"",checkTime:[],status:""}),h=r([{taskNo:"RW202401001",checkProject:"飞行部安全检查",department:"飞行部",checkTeam:["张三","李四"],checkTime:"2024-03-15 09:00",issueCount:3,status:"未开始"},{taskNo:"RW202401002",checkProject:"维修部例行检查",department:"维修部",checkTeam:["陈工","刘工"],checkTime:"2024-03-17 10:00",issueCount:0,status:"未开始"}]),X=r(!1),R=r(1),P=r(10),j=r(3),z=[{label:"飞行部",value:"飞行部"},{label:"维修部",value:"维修部"},{label:"运控部",value:"运控部"},{label:"客舱部",value:"客舱部"},{label:"货运部",value:"货运部"},{label:"安全部",value:"安全部"}],K=n=>({未开始:"info",进行中:"warning",已完成:"success"})[n]||"info",G=()=>{},J=()=>{v.value.taskNo="",v.value.department=""},f=r(!1),V=r("add"),L=r(),M=r(!1),$=()=>{V.value="add",o.taskNo="",o.checkProject="",o.department="",o.checkTeam=[],o.checkTime="",o.checkLocation="",o.checkItems=[],o.remark="",f.value=!0},Q=async()=>{if(L.value)try{await L.value.validate(),M.value=!0,await new Promise(e=>setTimeout(e,1e3));const n={taskNo:`RW${new Date().getTime()}`,checkProject:o.checkProject,department:o.department,checkTeam:o.checkTeam,checkTime:o.checkTime,checkLocation:o.checkLocation,checkItems:o.checkItems,remark:o.remark,status:"未开始",issueCount:0};if(V.value==="add")h.value.unshift(n),j.value++,ElMessage.success("新增成功");else{const e=h.value.findIndex(d=>d.taskNo===o.taskNo);e!==-1&&(h.value[e]={...h.value[e],...n},ElMessage.success("修改成功"))}f.value=!1}catch(n){console.error("表单验证失败:",n)}finally{M.value=!1}},Z=n=>{V.value="edit",Object.assign(o,{taskNo:n.taskNo,checkProject:n.checkProject,department:n.department,checkTeam:n.checkTeam,checkTime:n.checkTime,checkLocation:n.checkLocation,checkItems:n.checkItems||[],remark:n.remark}),f.value=!0},ee=async n=>{try{await ElMessageBox.confirm("确认删除该检查任务？","提示",{type:"warning"}),await new Promise(d=>setTimeout(d,500));const e=h.value.findIndex(d=>d.taskNo===n.taskNo);e!==-1&&(h.value.splice(e,1),j.value--,ElMessage.success("删除成功"))}catch{}},te=n=>{ElMessage.info("即将跳转到检查执行页面")},le=()=>{ElMessage.success("导出成功")},ae=n=>{P.value=n},se=n=>{R.value=n},o=A({taskNo:"",checkProject:"",department:"",checkTeam:[],checkTime:"",checkLocation:"",checkItems:[],remark:""}),oe={checkProject:[{required:!0,message:"请输入检查项目",trigger:"blur"}],department:[{required:!0,message:"请选择检查部门",trigger:"change"}],checkTeam:[{required:!0,message:"请选择检查组成员",trigger:"change"}],checkTime:[{required:!0,message:"请选择检查时间",trigger:"change"}],checkLocation:[{required:!0,message:"请输入检查地点",trigger:"blur"}],checkItems:[{required:!0,message:"请选择检查项",trigger:"change"}]},C=r(!1),_=r(""),q=r([]),S=[{itemNo:"CX-FLT-001",type:"运行检查",content:"飞行员资质检查",standard:"按照CCAR-121部要求检查飞行员执照和训练记录"},{itemNo:"CX-MNT-001",type:"维修检查",content:"航线维修检查",standard:"按照维修手册要求检查航线维修工作"}],U=r(S),ne=()=>{if(!_.value){U.value=S;return}U.value=S.filter(n=>n.itemNo.toLowerCase().includes(_.value.toLowerCase())||n.content.includes(_.value)||n.type.includes(_.value))},de=n=>{q.value=n},ie=()=>{o.checkItems.push(...q.value),C.value=!1},ce=n=>{o.checkItems.splice(n,1)},ue=r([{label:"张三",value:"张三"},{label:"李四",value:"李四"},{label:"王五",value:"王五"}]),re=n=>{o.checkTeam=[]};return(n,e)=>{const d=i("el-button"),y=i("el-card"),T=i("el-col"),B=i("el-progress"),pe=i("el-row"),w=i("el-input"),m=i("el-form-item"),g=i("el-option"),N=i("el-select"),F=i("el-date-picker"),H=i("el-form"),c=i("el-table-column"),me=i("el-tag"),D=i("el-table"),ve=i("el-pagination"),W=i("el-dialog"),ke=i("el-icon"),he=_e("loading");return b(),I("div",we,[s("div",Ve,[e[19]||(e[19]=s("h2",null,"检查任务",-1)),t(d,{type:"primary",onClick:$},{default:l(()=>e[18]||(e[18]=[u("新增任务")])),_:1})]),t(pe,{gutter:20,class:"statistics"},{default:l(()=>[t(T,{span:6},{default:l(()=>[t(y,{shadow:"hover",class:"statistics-card"},{header:l(()=>e[20]||(e[20]=[s("div",{class:"card-header"},[s("span",null,"本月任务总数")],-1)])),default:l(()=>[s("div",Te,[s("span",Ne,k(p.totalCount),1),s("div",xe,[s("span",Ie,"已完成: "+k(p.completedCount),1),s("span",Re,"待执行: "+k(p.pendingCount),1)])])]),_:1})]),_:1}),t(T,{span:6},{default:l(()=>[t(y,{shadow:"hover",class:"statistics-card"},{header:l(()=>e[21]||(e[21]=[s("div",{class:"card-header"},[s("span",null,"本月完成率")],-1)])),default:l(()=>[s("div",Pe,[s("span",je,k(p.completionRate)+"%",1),t(B,{percentage:p.completionRate,status:p.completionRate>=90?"success":"warning"},null,8,["percentage","status"])])]),_:1})]),_:1}),t(T,{span:6},{default:l(()=>[t(y,{shadow:"hover",class:"statistics-card"},{header:l(()=>e[22]||(e[22]=[s("div",{class:"card-header"},[s("span",null,"问题发现数")],-1)])),default:l(()=>[s("div",Le,[s("span",Me,k(p.issueCount),1),s("div",Se,[s("span",Ue,"高风险: "+k(p.highRiskCount),1),s("span",De,"中风险: "+k(p.mediumRiskCount),1)])])]),_:1})]),_:1}),t(T,{span:6},{default:l(()=>[t(y,{shadow:"hover",class:"statistics-card"},{header:l(()=>e[23]||(e[23]=[s("div",{class:"card-header"},[s("span",null,"问题整改率")],-1)])),default:l(()=>[s("div",Ye,[s("span",Ee,k(p.rectificationRate)+"%",1),t(B,{percentage:p.rectificationRate,status:p.rectificationRate>=90?"success":"warning"},null,8,["percentage","status"])])]),_:1})]),_:1})]),_:1}),s("div",ze,[t(H,{inline:!0,model:v.value,ref:"searchFormRef"},{default:l(()=>[t(m,{label:"任务编号"},{default:l(()=>[t(w,{modelValue:v.value.taskNo,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value.taskNo=a),placeholder:"请输入编号",clearable:""},null,8,["modelValue"])]),_:1}),t(m,{label:"检查部门"},{default:l(()=>[t(N,{modelValue:v.value.department,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value.department=a),placeholder:"请选择",clearable:""},{default:l(()=>[(b(),I(Y,null,E(z,a=>t(g,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"检查时间"},{default:l(()=>[t(F,{modelValue:v.value.checkTime,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value.checkTime=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(m,{label:"状态"},{default:l(()=>[t(N,{modelValue:v.value.status,"onUpdate:modelValue":e[3]||(e[3]=a=>v.value.status=a),placeholder:"请选择",clearable:""},{default:l(()=>[t(g,{label:"未开始",value:"未开始"}),t(g,{label:"进行中",value:"进行中"}),t(g,{label:"已完成",value:"已完成"})]),_:1},8,["modelValue"])]),_:1}),t(m,null,{default:l(()=>[t(d,{type:"primary",onClick:G},{default:l(()=>e[24]||(e[24]=[u("查询")])),_:1}),t(d,{onClick:J},{default:l(()=>e[25]||(e[25]=[u("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),t(y,{class:"table-card"},{header:l(()=>[s("div",$e,[e[28]||(e[28]=s("span",null,"检查任务列表",-1)),s("div",qe,[t(d,{type:"primary",onClick:$},{default:l(()=>e[26]||(e[26]=[u("新增任务")])),_:1}),t(d,{type:"success",onClick:le},{default:l(()=>e[27]||(e[27]=[u("导出")])),_:1})])])]),default:l(()=>[ge((b(),O(D,{data:h.value,border:"",stripe:"",style:{width:"100%"}},{default:l(()=>[t(c,{prop:"taskNo",label:"任务编号",width:"120"}),t(c,{prop:"checkProject",label:"检查项目","min-width":"180"}),t(c,{prop:"department",label:"检查部门",width:"120"}),t(c,{prop:"checkTeam",label:"检查组成员",width:"180"}),t(c,{prop:"checkTime",label:"检查时间",width:"180"}),t(c,{prop:"issueCount",label:"问题数",width:"100",align:"center"}),t(c,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:a})=>[t(me,{type:K(a.status)},{default:l(()=>[u(k(a.status),1)]),_:2},1032,["type"])]),_:1}),t(c,{label:"操作",width:"260",fixed:"right"},{default:l(({row:a})=>[t(d,{link:"",type:"primary",onClick:x=>Z(a)},{default:l(()=>e[29]||(e[29]=[u("编辑")])),_:2},1032,["onClick"]),t(d,{link:"",type:"primary",onClick:x=>n.handleView(a)},{default:l(()=>e[30]||(e[30]=[u("查看")])),_:2},1032,["onClick"]),t(d,{link:"",type:"primary",onClick:x=>te(a),disabled:a.status==="已完成"},{default:l(()=>e[31]||(e[31]=[u("执行")])),_:2},1032,["onClick","disabled"]),t(d,{link:"",type:"danger",onClick:x=>ee(a),disabled:a.status!=="未开始"},{default:l(()=>e[32]||(e[32]=[u("删除")])),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[he,X.value]]),s("div",Be,[t(ve,{"current-page":R.value,"onUpdate:currentPage":e[4]||(e[4]=a=>R.value=a),"page-size":P.value,"onUpdate:pageSize":e[5]||(e[5]=a=>P.value=a),total:j.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ae,onCurrentChange:se},null,8,["current-page","page-size","total"])])]),_:1}),t(W,{title:V.value==="add"?"新增检查任务":"编辑检查任务",modelValue:f.value,"onUpdate:modelValue":e[14]||(e[14]=a=>f.value=a),width:"700px","close-on-click-modal":!1},{footer:l(()=>[t(d,{onClick:e[13]||(e[13]=a=>f.value=!1)},{default:l(()=>e[35]||(e[35]=[u("取消")])),_:1}),t(d,{type:"primary",onClick:Q,loading:M.value},{default:l(()=>e[36]||(e[36]=[u("确定")])),_:1},8,["loading"])]),default:l(()=>[t(H,{ref_key:"formRef",ref:L,model:o,rules:oe,"label-width":"100px","status-icon":""},{default:l(()=>[t(m,{label:"检查项目",prop:"checkProject"},{default:l(()=>[t(w,{modelValue:o.checkProject,"onUpdate:modelValue":e[6]||(e[6]=a=>o.checkProject=a),placeholder:"请输入检查项目"},null,8,["modelValue"])]),_:1}),t(m,{label:"检查部门",prop:"department"},{default:l(()=>[t(N,{modelValue:o.department,"onUpdate:modelValue":e[7]||(e[7]=a=>o.department=a),placeholder:"请选择",onChange:re},{default:l(()=>[(b(),I(Y,null,E(z,a=>t(g,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"检查组成员",prop:"checkTeam"},{default:l(()=>[t(N,{modelValue:o.checkTeam,"onUpdate:modelValue":e[8]||(e[8]=a=>o.checkTeam=a),multiple:"",placeholder:"请选择检查组成员"},{default:l(()=>[(b(!0),I(Y,null,E(ue.value,a=>(b(),O(g,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"检查时间",prop:"checkTime"},{default:l(()=>[t(F,{modelValue:o.checkTime,"onUpdate:modelValue":e[9]||(e[9]=a=>o.checkTime=a),type:"datetime",placeholder:"选择日期时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(m,{label:"检查地点",prop:"checkLocation"},{default:l(()=>[t(w,{modelValue:o.checkLocation,"onUpdate:modelValue":e[10]||(e[10]=a=>o.checkLocation=a),placeholder:"请输入检查地点"},null,8,["modelValue"])]),_:1}),t(m,{label:"检查项",prop:"checkItems"},{default:l(()=>[s("div",Fe,[s("div",He,[s("div",We,[s("span",null,"已选检查项（"+k(o.checkItems.length)+"）",1),t(d,{link:"",type:"primary",onClick:e[11]||(e[11]=a=>C.value=!0)},{default:l(()=>e[33]||(e[33]=[u("添加检查项")])),_:1})]),t(D,{data:o.checkItems,style:{width:"100%"},size:"small","max-height":"200"},{default:l(()=>[t(c,{prop:"itemNo",label:"编号",width:"100"}),t(c,{prop:"content",label:"检查内容","show-overflow-tooltip":""}),t(c,{label:"操作",width:"80",align:"center"},{default:l(({$index:a})=>[t(d,{link:"",type:"danger",onClick:x=>ce(a)},{default:l(()=>e[34]||(e[34]=[u("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])])]),_:1}),t(m,{label:"备注",prop:"remark"},{default:l(()=>[t(w,{modelValue:o.remark,"onUpdate:modelValue":e[12]||(e[12]=a=>o.remark=a),type:"textarea",rows:"3",placeholder:"请输入备注信息",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(W,{title:"选择检查项",modelValue:C.value,"onUpdate:modelValue":e[17]||(e[17]=a=>C.value=a),width:"800px","append-to-body":""},{footer:l(()=>[t(d,{onClick:e[16]||(e[16]=a=>C.value=!1)},{default:l(()=>e[37]||(e[37]=[u("取消")])),_:1}),t(d,{type:"primary",onClick:ie},{default:l(()=>e[38]||(e[38]=[u("确定")])),_:1})]),default:l(()=>[s("div",Ae,[s("div",Oe,[t(w,{modelValue:_.value,"onUpdate:modelValue":e[15]||(e[15]=a=>_.value=a),placeholder:"搜索检查项",clearable:"",onInput:ne},{prefix:l(()=>[t(ke,null,{default:l(()=>[t(be(Ce))]),_:1})]),_:1},8,["modelValue"])]),s("div",Xe,[t(D,{ref:"itemSelectorTable",data:U.value,style:{width:"100%"},height:"400",onSelectionChange:de},{default:l(()=>[t(c,{type:"selection",width:"55"}),t(c,{prop:"itemNo",label:"编号",width:"120"}),t(c,{prop:"type",label:"类型",width:"120"}),t(c,{prop:"content",label:"检查内容","show-overflow-tooltip":""}),t(c,{prop:"standard",label:"检查标准","show-overflow-tooltip":""})]),_:1},8,["data"])])])]),_:1},8,["modelValue"])])}}});const Qe=ye(Ke,[["__scopeId","data-v-f6d8c1e3"]]);export{Qe as default};
