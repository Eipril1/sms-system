import{B as U}from"./BaseLibrary-fa67d690.js";import{d as z,r as b,L as T,k as j,f as r,h as p,i as B,e,m as u,t as h,_ as P}from"./index-97e706ba.js";const O=z({__name:"HiddenDangerLibrary",setup(W){const D=b(),R=b(),n=T({keyword:"",code:"",department:"",dangerType:"",status:""}),V=T({code:"",discoveryDate:"",department:"",name:"",source:"",dangerType:"",mainRisk:"",measures:"",deadline:"",isDevelopRisk:!1,riskCode:"",implementation:"",status:"",verifyInfo:"",verifier:"",closeTime:"",remark:""}),C={code:[{required:!0,message:"请输入隐患编号",trigger:"blur"}],title:[{required:!0,message:"请输入隐患标题",trigger:"blur"}],type:[{required:!0,message:"请选择隐患类型",trigger:"change"}],level:[{required:!0,message:"请选择隐患等级",trigger:"change"}],status:[{required:!0,message:"请选择处理状态",trigger:"change"}],description:[{required:!0,message:"请输入隐患描述",trigger:"blur"}],measures:[{required:!0,message:"请输入整改措施",trigger:"blur"}],department:[{required:!0,message:"请输入责任部门",trigger:"blur"}],deadline:[{required:!0,message:"请选择整改期限",trigger:"change"}]},L=l=>({normal:"一般",major:"重大"})[l]||l,x=l=>l==="major"?"danger":"info",q=l=>({closed:"已关闭",open:"未关闭"})[l]||l,F=l=>l==="closed"?"success":"warning",_=[{code:"HD-2024001",fromFindingNo:"FD-2024001",findings:[],discoveryDate:"2024-01-15",department:"飞行维修",name:"滑梯维护检查记录不完整",source:"日常检查",dangerType:"normal",mainRisk:"可能影响应急设备可靠性",measures:"完善维护检查记录流程，加强记录管理",deadline:"2024-02-15",isDevelopRisk:!0,riskCode:"T-WX2024001",implementation:"已进行",status:"closed",verifyInfo:"检查记录完整性提升至98%",verifier:"李洪涛",closeTime:"2024-02-10",remark:""},{code:"RLOP-2024002",discoveryDate:"2024-01-20",department:"运行控制",name:"航班放行文件未按规定时限存档",source:"内部审核",dangerType:"normal",mainRisk:"影响运行数据追溯",measures:"优化文件管理系统，明确存档职责",deadline:"2024-02-20",isDevelopRisk:!0,riskCode:"T-OPS2024002",implementation:"进行中",status:"open",verifyInfo:"正在实施系统升级",verifier:"张明",closeTime:"",remark:"系统升级预计2024年3月完成"},{code:"RLSF-2024003",discoveryDate:"2024-02-01",department:"安全监察",name:"部分机组疲劳风险报告填写不规范",source:"安全检查",dangerType:"major",mainRisk:"可能影响机组执勤安全",measures:"开展疲劳管理培训，完善报告系统",deadline:"2024-02-29",isDevelopRisk:!0,riskCode:"T-FLT2024003",implementation:"已完成",status:"closed",verifyInfo:"报告规范性提升至95%",verifier:"王建国",closeTime:"2024-02-25",remark:"后续将持续跟踪监控"},{code:"RLWX-2024004",discoveryDate:"2024-02-05",department:"飞行维修",name:"APU滑油消耗异常未及时分析",source:"技术分析",dangerType:"major",mainRisk:"可能影响发动机可靠性",measures:"制定滑油消耗监控标准，建立分析机制",deadline:"2024-03-05",isDevelopRisk:!0,riskCode:"T-WX2024004",implementation:"进行中",status:"open",verifyInfo:"正在收集分析数据",verifier:"陈工",closeTime:"",remark:"需要收集3个月数据进行分析"},{code:"RLOP-2024005",discoveryDate:"2024-02-10",department:"运行控制",name:"新机场天气报告获取延迟",source:"运行反馈",dangerType:"normal",mainRisk:"影响航班计划制定准确性",measures:"优化天气信息获取渠道，增加备用数据源",deadline:"2024-03-10",isDevelopRisk:!1,riskCode:"",implementation:"计划中",status:"open",verifyInfo:"待实施",verifier:"赵航",closeTime:"",remark:"正在与气象部门协调"}],w=b(_),H=()=>{const{keyword:l,code:a,department:c,dangerType:s,status:m}=n,o=_.filter(d=>{const f=!l||d.code.toLowerCase().includes(l.toLowerCase())||d.name.toLowerCase().includes(l.toLowerCase()),v=!a||d.code.toLowerCase().includes(a.toLowerCase()),y=!c||d.department===c,k=!s||d.dangerType===s,t=!m||d.status===m;return f&&v&&y&&k&&t});w.value=o},S=()=>{n.keyword="",n.code="",n.department="",n.dangerType="",n.status="",w.value=_},g=b(!1),i=T({description:"",level:"",sourceType:"hazard",parentHazardNo:""}),I=l=>{i.parentHazardNo=l.code,g.value=!0},N=async()=>{await createFinding({...i,source:"hazard-treatment",sourceNo:i.parentHazardNo}),await updateHazard({code:i.parentHazardNo,findings:[...currentFindings,newFindingCode]})};return(l,a)=>{const c=p("el-input"),s=p("el-option"),m=p("el-select"),o=p("el-table-column"),d=p("el-tag"),f=p("el-button"),v=p("el-form"),y=p("el-form-item"),k=p("el-dialog");return B(),j(U,{ref_key:"libraryRef",ref:D,data:w.value,onSearch:H,onReset:S},{"extra-search":r(()=>[e(c,{modelValue:n.code,"onUpdate:modelValue":a[0]||(a[0]=t=>n.code=t),placeholder:"编号",clearable:"",class:"search-input"},null,8,["modelValue"]),e(m,{modelValue:n.department,"onUpdate:modelValue":a[1]||(a[1]=t=>n.department=t),placeholder:"所属部门",clearable:""},{default:r(()=>[e(s,{label:"安全监察",value:"safety"}),e(s,{label:"飞行维修",value:"maintenance"}),e(s,{label:"运行控制",value:"operation"})]),_:1},8,["modelValue"]),e(m,{modelValue:n.dangerType,"onUpdate:modelValue":a[2]||(a[2]=t=>n.dangerType=t),placeholder:"隐患类型",clearable:""},{default:r(()=>[e(s,{label:"一般",value:"normal"}),e(s,{label:"重大",value:"major"})]),_:1},8,["modelValue"]),e(m,{modelValue:n.status,"onUpdate:modelValue":a[3]||(a[3]=t=>n.status=t),placeholder:"关闭情况",clearable:""},{default:r(()=>[e(s,{label:"已关闭",value:"closed"}),e(s,{label:"未关闭",value:"open"})]),_:1},8,["modelValue"])]),columns:r(()=>[e(o,{type:"index",label:"序号",width:"60"}),e(o,{prop:"discoveryDate",label:"录入日期",width:"100"}),e(o,{prop:"department",label:"所属部门",width:"120"}),e(o,{prop:"name",label:"隐患名称","min-width":"200","show-overflow-tooltip":""}),e(o,{prop:"code",label:"隐患编号",width:"120"}),e(o,{prop:"source",label:"隐患来源",width:"120"}),e(o,{prop:"dangerType",label:"隐患类型",width:"100"},{default:r(({row:t})=>[e(d,{type:x(t.dangerType)},{default:r(()=>[u(h(L(t.dangerType)),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"mainRisk",label:"主要风险","min-width":"150","show-overflow-tooltip":""}),e(o,{prop:"measures",label:"治理措施","min-width":"200","show-overflow-tooltip":""}),e(o,{prop:"deadline",label:"整改期限",width:"100"}),e(o,{prop:"isDevelopRisk",label:"是否开展危险源识别",width:"150"},{default:r(({row:t})=>[e(d,{type:t.isDevelopRisk?"success":"info"},{default:r(()=>[u(h(t.isDevelopRisk?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"riskCode",label:"危险源对应编号",width:"140"}),e(o,{prop:"implementation",label:"措施落实",width:"120"}),e(o,{prop:"status",label:"关闭情况",width:"100"},{default:r(({row:t})=>[e(d,{type:F(t.status)},{default:r(()=>[u(h(q(t.status)),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"verifyInfo",label:"验证情况","min-width":"150","show-overflow-tooltip":""}),e(o,{prop:"verifier",label:"验证人",width:"100"}),e(o,{prop:"closeTime",label:"安全隐患关闭时间",width:"160"}),e(o,{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}),e(o,{label:"操作",width:"200",fixed:"right"},{default:r(({row:t})=>[e(f,{type:"primary",link:"",onClick:X=>I(t)},{default:r(()=>a[8]||(a[8]=[u(" 新增发现项 ")])),_:2},1032,["onClick"])]),_:1})]),form:r(()=>[e(v,{ref_key:"formRef",ref:R,model:V,rules:C,"label-width":"120px"},null,8,["model"])]),default:r(()=>[e(k,{modelValue:g.value,"onUpdate:modelValue":a[7]||(a[7]=t=>g.value=t),title:"新增发现项",width:"600px"},{footer:r(()=>[e(f,{onClick:a[6]||(a[6]=t=>g.value=!1)},{default:r(()=>a[9]||(a[9]=[u("取消")])),_:1}),e(f,{type:"primary",onClick:N},{default:r(()=>a[10]||(a[10]=[u("确认")])),_:1})]),default:r(()=>[e(v,{model:i,"label-width":"100px"},{default:r(()=>[e(y,{label:"问题描述",required:""},{default:r(()=>[e(c,{modelValue:i.description,"onUpdate:modelValue":a[4]||(a[4]=t=>i.description=t),type:"textarea"},null,8,["modelValue"])]),_:1}),e(y,{label:"问题等级",required:""},{default:r(()=>[e(m,{modelValue:i.level,"onUpdate:modelValue":a[5]||(a[5]=t=>i.level=t)},{default:r(()=>[e(s,{label:"一般",value:"normal"}),e(s,{label:"重要",value:"major"}),e(s,{label:"严重",value:"severe"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1},8,["data"])}}});const K=P(O,[["__scopeId","data-v-f9349cd1"]]);export{K as default};
