import{B as E}from"./BaseLibrary-fa67d690.js";import{d as K,r as y,L as F,k as Z,f as t,h as m,i as A,e,m as c,t as q,_ as G}from"./index-97e706ba.js";const M=K({__name:"FindingsLibrary",setup(P){const x=y(),D=y(),i=F({keyword:"",code:"",source:"",level:"",status:""}),z=n=>({supervision:"监督检查","self-inspection":"法定自查","internal-audit":"内部审核","external-audit":"外部审核"})[n]||n,C=n=>({normal:"一般",major:"重要",severe:"严重"})[n]||n,U=n=>({normal:"info",major:"warning",severe:"danger"})[n]||"info",h=n=>({pending:"待整改",processing:"整改中",verifying:"待验证",closed:"已关闭"})[n]||n,H=n=>({pending:"info",processing:"warning",verifying:"warning",closed:"success"})[n]||"info",w=[{code:"FD-2024001",source:"supervision",sourceType:"checklist",sourceNo:"RLSJ-2024002",parentHazardNo:"",toHazardNo:"",findingDate:"2024-02-26",department:"飞行部",description:"部分机组成员疲劳风险报告填写不规范",level:"major",requirement:"完善报告填写流程，加强培训",deadline:"2024-03-10",measures:"1.修订报告填写指南；2.开展专项培训；3.加强日常监督",status:"processing",verifyInfo:"",verifier:"",closeDate:"",remark:"整改进行中"},{code:"FD-2024002",source:"self-inspection",sourceType:"checklist",sourceNo:"RLZJ-2024005",parentHazardNo:"",toHazardNo:"",findingDate:"2024-02-25",department:"维修部",description:"工具借用登记不完整",level:"normal",requirement:"规范工具借用管理",deadline:"2024-03-05",measures:"完善工具管理系统，加强交接班检查",status:"verifying",verifyInfo:"待现场核实",verifier:"张工",closeDate:"",remark:""},{code:"FD-2024003",source:"internal-audit",sourceType:"checklist",sourceNo:"RLSN-2024008",parentHazardNo:"",toHazardNo:"",findingDate:"2024-02-20",department:"运控部",description:"部分航班放行文件未按规定时限存档",level:"major",requirement:"及时完成文件存档",deadline:"2024-03-01",measures:"优化存档流程，明确责任人",status:"closed",verifyInfo:"已完成整改验证",verifier:"李监察",closeDate:"2024-02-28",remark:"按期完成整改"},{code:"FD-2024004",source:"supervision",sourceType:"checklist",sourceNo:"RLSJ-2024009",parentHazardNo:"",toHazardNo:"",findingDate:"2024-02-28",department:"维修部",description:"发动机振动值超限未及时处置",level:"severe",requirement:"立即排查原因，采取措施",deadline:"2024-03-01",measures:"1.执行发动机振动排查程序；2.必要时更换部件；3.完善监控机制",status:"processing",verifyInfo:"",verifier:"",closeDate:"",remark:"优先处理"},{code:"FD-2024005",source:"internal-audit",sourceType:"checklist",sourceNo:"RLSN-2024010",parentHazardNo:"",toHazardNo:"",findingDate:"2024-02-27",department:"飞行部",description:"发现多起高原机场着陆偏差超标",level:"severe",requirement:"分析原因，加强培训",deadline:"2024-03-05",measures:"1.分析气象和人为因素；2.修订高原机场运行程序；3.开展专项训练",status:"processing",verifyInfo:"",verifier:"",closeDate:"",remark:"需要局方参与"}],V=y(w),S=()=>{const{keyword:n,code:l,source:u,level:o,status:p}=i,d=w.filter(f=>{const v=!n||f.description.toLowerCase().includes(n.toLowerCase())||f.code.toLowerCase().includes(n.toLowerCase()),s=!l||f.code.toLowerCase().includes(l.toLowerCase()),k=!u||f.source===u,N=!o||f.level===o,L=!p||f.status===p;return v&&s&&k&&N&&L});V.value=d},T=()=>{i.keyword="",i.code="",i.source="",i.level="",i.status="",V.value=w},_=y(!1),g=F({dangerType:"",fromFindingNo:""}),I=n=>{g.fromFindingNo=n.code,_.value=!0},R=async()=>{const n=await createHazard({...g,fromFindingNo:g.fromFindingNo});await updateFinding({code:g.fromFindingNo,toHazardNo:n.code,status:"upgraded"})},b=y(!1),r=F({code:"",description:"",level:"",department:"",requirement:"",deadline:"",measures:"",status:"",verifyInfo:"",verifier:"",remark:""}),j={description:[{required:!0,message:"请输入问题描述",trigger:"blur"}],level:[{required:!0,message:"请选择问题等级",trigger:"change"}],department:[{required:!0,message:"请选择责任部门",trigger:"change"}],requirement:[{required:!0,message:"请输入整改要求",trigger:"blur"}],deadline:[{required:!0,message:"请选择整改期限",trigger:"change"}],measures:[{required:!0,message:"请输入整改措施",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},B=n=>{Object.assign(r,n),b.value=!0},$=async()=>{D.value&&await D.value.validate(async n=>{n&&(r.code?await updateFinding({...r}):await createFinding({...r,code:generateFindingCode(),findingDate:new Date().toISOString().split("T")[0]}),b.value=!1,await J())})},J=async()=>{V.value=[...w]};return(n,l)=>{const u=m("el-input"),o=m("el-option"),p=m("el-select"),d=m("el-table-column"),f=m("el-tag"),v=m("el-button"),s=m("el-form-item"),k=m("el-form"),N=m("el-dialog"),L=m("el-date-picker");return A(),Z(E,{ref_key:"libraryRef",ref:x,data:V.value,onSearch:S,onReset:T},{"extra-search":t(()=>[e(u,{modelValue:i.code,"onUpdate:modelValue":l[0]||(l[0]=a=>i.code=a),placeholder:"发现项编号",clearable:"",class:"search-input"},null,8,["modelValue"]),e(p,{modelValue:i.source,"onUpdate:modelValue":l[1]||(l[1]=a=>i.source=a),placeholder:"来源",clearable:""},{default:t(()=>[e(o,{label:"监督检查",value:"supervision"}),e(o,{label:"法定自查",value:"self-inspection"}),e(o,{label:"内部审核",value:"internal-audit"}),e(o,{label:"外部审核",value:"external-audit"})]),_:1},8,["modelValue"]),e(p,{modelValue:i.level,"onUpdate:modelValue":l[2]||(l[2]=a=>i.level=a),placeholder:"问题等级",clearable:""},{default:t(()=>[e(o,{label:"一般",value:"normal"}),e(o,{label:"重要",value:"major"}),e(o,{label:"严重",value:"severe"})]),_:1},8,["modelValue"]),e(p,{modelValue:i.status,"onUpdate:modelValue":l[3]||(l[3]=a=>i.status=a),placeholder:"状态",clearable:""},{default:t(()=>[e(o,{label:"待整改",value:"pending"}),e(o,{label:"整改中",value:"processing"}),e(o,{label:"待验证",value:"verifying"}),e(o,{label:"已关闭",value:"closed"})]),_:1},8,["modelValue"])]),columns:t(()=>[e(d,{type:"index",label:"序号",width:"60"}),e(d,{prop:"code",label:"发现项编号",width:"120"}),e(d,{prop:"source",label:"来源",width:"100"},{default:t(({row:a})=>[c(q(z(a.source)),1)]),_:1}),e(d,{prop:"sourceNo",label:"来源编号",width:"120"}),e(d,{prop:"parentHazardNo",label:"关联隐患编号",width:"120"}),e(d,{prop:"toHazardNo",label:"升级隐患编号",width:"120"}),e(d,{prop:"findingDate",label:"发现日期",width:"100"}),e(d,{prop:"department",label:"责任部门",width:"100"}),e(d,{prop:"description",label:"问题描述","min-width":"200","show-overflow-tooltip":""}),e(d,{prop:"level",label:"问题等级",width:"100"},{default:t(({row:a})=>[e(f,{type:U(a.level)},{default:t(()=>[c(q(C(a.level)),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"requirement",label:"整改要求","min-width":"200","show-overflow-tooltip":""}),e(d,{prop:"deadline",label:"整改期限",width:"100"}),e(d,{prop:"measures",label:"整改措施","min-width":"200","show-overflow-tooltip":""}),e(d,{prop:"status",label:"状态",width:"100"},{default:t(({row:a})=>[e(f,{type:H(a.status)},{default:t(()=>[c(q(h(a.status)),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"verifyInfo",label:"验证情况","min-width":"150","show-overflow-tooltip":""}),e(d,{prop:"verifier",label:"验证人",width:"100"}),e(d,{prop:"closeDate",label:"关闭日期",width:"100"}),e(d,{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}),e(d,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[e(v,{type:"primary",link:"",onClick:O=>B(a)},{default:t(()=>l[19]||(l[19]=[c(" 编辑 ")])),_:2},1032,["onClick"]),e(v,{type:"warning",link:"",onClick:O=>I(a)},{default:t(()=>l[20]||(l[20]=[c(" 升级为隐患 ")])),_:2},1032,["onClick"])]),_:1})]),default:t(()=>[e(N,{modelValue:_.value,"onUpdate:modelValue":l[6]||(l[6]=a=>_.value=a),title:"升级为隐患",width:"600px"},{footer:t(()=>[e(v,{onClick:l[5]||(l[5]=a=>_.value=!1)},{default:t(()=>l[21]||(l[21]=[c("取消")])),_:1}),e(v,{type:"primary",onClick:R},{default:t(()=>l[22]||(l[22]=[c("确认")])),_:1})]),default:t(()=>[e(k,{model:g,"label-width":"100px"},{default:t(()=>[e(s,{label:"隐患类型",required:""},{default:t(()=>[e(p,{modelValue:g.dangerType,"onUpdate:modelValue":l[4]||(l[4]=a=>g.dangerType=a)},{default:t(()=>[e(o,{label:"一般",value:"normal"}),e(o,{label:"重大",value:"major"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(N,{modelValue:b.value,"onUpdate:modelValue":l[18]||(l[18]=a=>b.value=a),title:r.code?"编辑发现项":"新增发现项",width:"650px"},{footer:t(()=>[e(v,{onClick:l[17]||(l[17]=a=>b.value=!1)},{default:t(()=>l[23]||(l[23]=[c("取消")])),_:1}),e(v,{type:"primary",onClick:$},{default:t(()=>l[24]||(l[24]=[c("确定")])),_:1})]),default:t(()=>[e(k,{model:r,rules:j,ref_key:"formRef",ref:D,"label-width":"100px"},{default:t(()=>[e(s,{label:"问题描述",prop:"description"},{default:t(()=>[e(u,{modelValue:r.description,"onUpdate:modelValue":l[7]||(l[7]=a=>r.description=a),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),e(s,{label:"问题等级",prop:"level"},{default:t(()=>[e(p,{modelValue:r.level,"onUpdate:modelValue":l[8]||(l[8]=a=>r.level=a),placeholder:"请选择"},{default:t(()=>[e(o,{label:"一般",value:"normal"}),e(o,{label:"重要",value:"major"}),e(o,{label:"严重",value:"severe"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"责任部门",prop:"department"},{default:t(()=>[e(p,{modelValue:r.department,"onUpdate:modelValue":l[9]||(l[9]=a=>r.department=a),placeholder:"请选择"},{default:t(()=>[e(o,{label:"飞行部",value:"飞行部"}),e(o,{label:"维修部",value:"维修部"}),e(o,{label:"运控部",value:"运控部"}),e(o,{label:"安全部",value:"安全部"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"整改要求",prop:"requirement"},{default:t(()=>[e(u,{modelValue:r.requirement,"onUpdate:modelValue":l[10]||(l[10]=a=>r.requirement=a),type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1}),e(s,{label:"整改期限",prop:"deadline"},{default:t(()=>[e(L,{modelValue:r.deadline,"onUpdate:modelValue":l[11]||(l[11]=a=>r.deadline=a),type:"date",placeholder:"选择日期"},null,8,["modelValue"])]),_:1}),e(s,{label:"整改措施",prop:"measures"},{default:t(()=>[e(u,{modelValue:r.measures,"onUpdate:modelValue":l[12]||(l[12]=a=>r.measures=a),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),e(s,{label:"状态",prop:"status"},{default:t(()=>[e(p,{modelValue:r.status,"onUpdate:modelValue":l[13]||(l[13]=a=>r.status=a),placeholder:"请选择"},{default:t(()=>[e(o,{label:"待整改",value:"pending"}),e(o,{label:"整改中",value:"processing"}),e(o,{label:"待验证",value:"verifying"}),e(o,{label:"已关闭",value:"closed"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"验证情况",prop:"verifyInfo"},{default:t(()=>[e(u,{modelValue:r.verifyInfo,"onUpdate:modelValue":l[14]||(l[14]=a=>r.verifyInfo=a)},null,8,["modelValue"])]),_:1}),e(s,{label:"验证人",prop:"verifier"},{default:t(()=>[e(u,{modelValue:r.verifier,"onUpdate:modelValue":l[15]||(l[15]=a=>r.verifier=a)},null,8,["modelValue"])]),_:1}),e(s,{label:"备注"},{default:t(()=>[e(u,{modelValue:r.remark,"onUpdate:modelValue":l[16]||(l[16]=a=>r.remark=a),type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1},8,["data"])}}});const X=G(M,[["__scopeId","data-v-fb356e6f"]]);export{X as default};
